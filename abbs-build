#! /bin/bash

export ABBS=`cat /etc/abbs/prefix`
. $ABBS/env/base.sh

for i
do
	case "$i" in
		(groups/*)
			L+=" $(<"$ABBS/repo/$i")";;
		(*/*)
			L+=" $i"
		(*)
			candidate=( "$ABBS/repo/"*/"$i" )
			[ "$candidate" != "$ABBS/repo/*/$i" ] || abdie "No vaild candidate for $i found."
			# Now fetch the last two layers of $candidate (=candidate[0])
			candy_dir="${candidate##*/}"
			# And do a simple basename to each.
			L+=" ${candy_dir%*/}${candidate%*/}"
	esac
done

# Now that we have found all the packages, go.
exec $ABBS/abbs-build-mini $L
